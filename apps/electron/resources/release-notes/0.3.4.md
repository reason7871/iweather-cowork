# v0.3.4 — 技能约定和 Windows 构建改进

支持 `.agents/skills` 约定和主要的 Windows 构建可靠性改进。

---

## ✨ 支持 `.agents/skills` 约定

技能现在可以放在 `.agents/skills` 目录中，遵循新兴的跨工具标准。

### 新功能

**跨工具兼容性**
将你的技能放在 `~/.agents/skills/`，它们将与 iWeather、Codex、Gemini 和其他支持此约定的工具一起使用。你现有的工作区技能继续像以前一样工作。

---

## ✨ 主题配置优先级修复

配置文件主题设置现在正确覆盖 localStorage。

### 工作原理

**配置为准**
当你在 `~/.iweather/config.json` 中设置 `colorTheme` 时，它现在正确优先于 localStorage 中的任何缓存主题。这使得代理可以通过文档化的配置路径修改主题。

---

## 改进

### 错误处理
- AI 提供商错误的有用消息（内部服务器错误、api_error），并提供检查状态页面的指导
- 自定义模型支持现在在摘要中正确工作 — 对所有内部模型调用使用 `resolveModelId()`

### 技能
- 修复技能提及格式 — `@` 提及现在生成正确的工作区别名格式而不是原始 UUID
- 步骤滚动行为改进 — "步骤已完成"现在滚动到最近的步骤

### UI
- 防止 EditPopover 在视口外渲染
- 修复时间显示显示 "60m" 而不是 "1h"
- 保留多行用户消息中的换行符（Shift+Enter）

### Linux (Hyprland/Wayland)
- Hyprland/Wayland 的窗口关闭超时回退，其中 IPC 可能失败

---

## Bug 修复

- **技能**：修复 `@` 技能提及生成错误 ID 格式（UUID 而不是工作区别名）
- **UI**：EditPopover 现在保持在视口边界内
- **Linux**：Hyprland/Wayland 环境的窗口关闭超时回退

---

## 构建和 CI (Windows)

Windows 构建可靠性的主要改进：

- 打包包而不是标记为外部以获得更好的兼容性
- 使用 `--linker=hoisted` 进行 Windows bun install 以避免 `.bun` 符号链接
- 通过 extraResources 打包 SDK 以绕过 node_modules 排除
- 添加 `bun.lock` 用于一致的跨平台构建
- 更正 afterPack.cjs 中的应用包名称
- Windows 打包的多个符号链接处理修复

---

## 统计

- **32 个文件更改**
- **约 4,200 行添加**

---

**完整变更日志**: [v0.3.3...v0.3.4](https://github.com/reason7871/iweather-cowork/compare/v0.3.3...v0.3.4)
