# v0.3.5 — Claude Opus 4.6 和自动更新可靠性

Claude Opus 4.6 模型支持、可靠的 macOS 自动更新进度、自动图片调整和技能提及改进。

---

## 🧠 Claude Opus 4.6 支持

iWeather 现在支持 **Claude Opus 4.6** (`claude-opus-4-6`) — Anthropic 最新最强大的模型。

### 变更内容

- **新的顶级模型** — Opus 4.6 已发布，现在也在 iWeather 中可用！
- **随处可用** — 设置页面、聊天模型选择器、测试场和 `call_llm` 工具
- **Opus 4.5 仍可用** — 列为"上一代"供偏好它的用户使用

---

## 🔄 可靠的 macOS 自动更新

升级 electron-updater 到 v6.8.0+，修复了 macOS 上下载进度事件发送问题。

### 变更内容

- **真实下载百分比** — macOS 现在显示实际下载进度而不是不确定的旋转器
- **移除了约 150 行变通代码** — macOS 文件监视器回退不再需要
- **可靠的 update-downloaded 事件** — 更新可靠完成，不会卡住

---

## 🖼️ 自动图片调整

大图片现在自动调整大小，而不是被拒绝并报错。

### 变更内容

- 超过 8000px 维度限制的图片会 **自动调整大小** 以适应 API 限制
- 类型化错误代码（`ImageValidationError`）以便更好的程序化处理
- 调整大小不可能时有更清晰的错误消息

---

## 🛠️ 技能提及改进

- **工作区 ID 支持点号** — 技能提及现在支持工作区 ID 中的点号（`.`），除了空格、连字符和下划线
- **工作区 slug 支持空格** — 正则表达式模式更新以兼容 Windows 路径
- **28 个新单元测试** 覆盖各种工作区 ID 格式的技能模式解析

---

## 改进

### SDK 更新
- Claude Agent SDK 从 0.2.19 更新到 0.2.34（CLI 2.1.31 → 2.1.34）
- 新的"谨慎执行操作"系统提示部分
- 增强的 Git 安全协议说明

### 开发者体验
- 添加 Husky pre-commit 钩子在提交前运行类型检查
- 修复 shared 和 core 包中的 TypeScript 错误以实现干净构建
- 添加提取的 Claude Code 系统提示用于 SDK 版本跟踪

### UI
- 修复右键上下文菜单中的状态图标颜色

### 文档
- 向 Gmail 数据源指南添加故障排除部分（API 启用、OAuth 凭据）

---

## Bug 修复

- **自动更新**：macOS 下载进度现在可靠工作（升级了 electron-updater）
- **图片**：大图片自动调整大小而不是抛出错误
- **技能提及**：修复正则表达式使用空格而不是 `\s`（防止换行匹配）
- **上下文菜单**：状态图标 SVG 颜色现在正确渲染
- **TypeScript**：修复重复导出、缺少错误代码和类型不匹配

---

## 统计

- **40 个文件更改**

---

**完整变更日志**: [v0.3.4...v0.3.5](https://github.com/reason7871/iweather-cowork/compare/v0.3.4...v0.3.5)
